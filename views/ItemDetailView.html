<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>Current Inventory</title>
    <script src="javascripts/QueryStringHelper.js"></script>
    <script src="javascripts/DetailViewButtons.js"></script>
</head>

<body>
<div class="item-detail-view-container">

    <div class="detail_view_buttons">

        <div class="detail_view">
            <button id="Add" onclick="Add()">Add</button>
        </div>

        <div class="detail_view">
            <button id="Pull" onclick="Pull()">Pull</button>
        </div>

        <div class="detail_view">
            <button id="Edit" onclick="Edit()">Edit</button>
        </div>

    </div>

        <div class="item-container"></div>
    </div>


<script>
    var $ = jQuery;

    var detailView = {

        host: window.apiRoute + "/itemDetail/",
        productID: null,
        productName: "",

        getParameterByName: function(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results === null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        },

        init: function( inputProdID ) {
            var self = this;

            this.productID = inputProdID || this.getParameterByName("prodid") || null;

            if (this.productID === null) {
                if (window.args && window.args.ProductID) {
                    this.productID = window.args.ProductID;
                }
            }

            if (this.productID === null) return;

            $.get( this.host.concat(this.productID).concat('/'), function( response ) {

                if( response && response.length ){

                    self.item = jQuery.parseJSON( response );
                    console.log(self.item);
                    self.display_item();
                    self.productName = self.item[0].Name;

                }
                else {

                    self.render_error( "No inventory found" );
                }

            }).fail( function( response ){

                self.render_error( "Failed to load inventory: " + response );

            });

        },

        display_item: function() {
            var productID = this.getParameterByName("prodid");
            var item_container = $( '.item-container' );
            var item = this.item[0];
            var inventory_item = "<div class='inventory-item'>";

            inventory_item += "<div id=\"productName\"><span id=\'productNameSpan\'>"
                                + item.Name + "</span></div>";
            inventory_item += "<div id=\"totalQuantity\">Total Quantity: <span id=\'totalQuantitySpan\'>"
                                + item.total + "</span></div>";
            inventory_item += "<div id=\"mostRecentRun\">Last run: <span id=\'totalQuantitySpan\'>"
                                + item.mostRecent + "</span></div>";
            inventory_item += "<div id=\"productID\" style=\"display: none;\"><span id=\'productIDSpan\'>"
                                + productID + "</span></div>";
            inventory_item += "</div>";

            item_container.append( inventory_item );
        },

        render_error: function( error ) {
            $( 'body').prepend( "<div class='error-message'>" + error + "</div>" );
        }
    };

    if (detailView.productID === null) {
        detailView.init();
    }
</script>
</body>
</html>
>
